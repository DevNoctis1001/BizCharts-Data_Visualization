<html>
<head>
    <script src="//g.alicdn.com/bizcharts/io-asserts/3.1.2/react16.0.0.production.min.js"></script>
    <script src="//g.alicdn.com/bizcharts/io-asserts/3.1.2/react-dom16.0.0.production.min.js"></script>
    <script src="//cdn.bootcss.com/babel-core/5.8.38/browser.min.js"></script>
    <script src="//g.alicdn.com/bizcharts/io-asserts/3.1.5/BizCharts.min.js"> </script>
    <script type="text/javascript" src="//gw.alipayobjects.com/os/antv/assets/data-set/0.8.6/data-set.min.js"></script>
    <script src="https://gw.alipayobjects.com/os/antv/assets/g2-brush/0.0.2/g2-brush.min.js"></script>
    <script type="text/javascript" src="https://gw.alipayobjects.com/as/g/datavis/assets/1.0.1/jquery-3.2.1.min.js"></script>  
  </head>
  <body>
      <div id="mountNode"><div id="canvas1"></div><div id="canvas2"></div></div>
      <script type="text/babel">
      const { Chart, Geom, Axis, Tooltip, Coord, Label, Legend, View, Guide, Shape } = window.BizCharts;
      $('#mountNode').html('<div id="canvas1"></div><div id="canvas2"></div>');
      $.getJSON('/BizCharts/public/data/sp500.json', data => {
        const ds = new DataSet({
            state: {
                dates: null
            }
        });
        const totalDv = ds.createView().source(data);
        const dv = ds.createView();
        dv.source(data)
            .transform({
                type: 'filter',
                callback: obj => {
                    if (ds.state.dates) {
                        return ds.state.dates.indexOf(obj.date) > -1;
                    }
                    return obj;
                }
            });
            const scale1 = {
              date: {
                    tickCount: 10,
                    type: 'time',
                    mask: 'MMM D YYYY'
                },
                price: {
                    min: totalDv.min('price'),
                    max: totalDv.max('price')
              }
            }
            const scale2 = {
              date: {
                  tickCount: 10,
                  type: 'time',
                  mask: 'YYYY'
              }
            }
            let chart2;
      class DoubleChart extends React.Component {
        componentDidMount() {
          new Brush({
                canvas: chart2.get('canvas'),
                chart: chart2,
                type: 'X',
                dragable: true,
                onBrushmove(ev) {
                    const {date} = ev;
                    ds.setState('dates', date);
                },
                onDragmove(ev) {
                    const {date} = ev;
                    ds.setState('dates', date);
                }
              });
        }
        render() {
          return (
            <div>
              <Chart 
              height={window.innerHeight * (4 / 5)} 
              data={dv} 
              padding={[100, 40, 50, 80]} 
              scale={scale1} 
              animate={false}
              forceFit
            >
              <Axis />
              <Tooltip />
              <Geom type="area" position="date*price" shape="smooth" opacity={0.85} />
            </Chart>
            <Chart 
              height={window.innerHeight * (1 / 5)} 
              data={data} 
              padding={[5, 40, 60, 80]} 
              scale={scale2} 
              onGetG2Instance={g2Chart => {
              chart2 = g2Chart;
              }} 
              forceFit
            >
              <Axis name="price" visible={false} />
              <Geom type="area" position="date*price" shape="smooth" acitve={false} opacity={0.85} />
            </Chart>
            </div>
          )
        }
      }

      ReactDOM.render((
        <DoubleChart />
      ), document.getElementById("mountNode"));
    });
    </script>
</body>
</html>
